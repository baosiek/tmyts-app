<div>
    @if (spinnerFlagIsSet){
    <div class="spinner-container">
        <mat-spinner></mat-spinner>
    </div>
    } @else {
        @if (dataSource.data.length == 0){
            <div class="empty-portfolio">
                <span>Portfolio is empty</span>
            </div>            
        } @else {
            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

            <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->

            <!-- Symbol Column -->
            <ng-container matColumnDef="symbol">
                <th mat-header-cell *matHeaderCellDef> Symbol </th>
                <td mat-cell *matCellDef="let element"> {{element.symbol}} </td>
            </ng-container>

            <!-- Symbol name Column -->
            <ng-container matColumnDef="symbol_name">
                <th mat-header-cell *matHeaderCellDef> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.symbol_name}} </td>
            </ng-container>

            <!-- Broker name in Column -->
            <ng-container matColumnDef="broker_name">
                <th mat-header-cell *matHeaderCellDef> Broker </th>
                <td mat-cell *matCellDef="let element"> {{element.broker_name}} </td>
            </ng-container>

            <!-- Quantity Column -->
            <ng-container matColumnDef="total_quantity">
                <th mat-header-cell *matHeaderCellDef> Quantity to Sell </th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field appearance="outline" style="padding-top: 5%;">
                        <input matInput [disabled]="element !== selectedSymbol" placeholder="{{element.total_quantity}}"
                            [(ngModel)]="element.total_quantity">
                    </mat-form-field>
                </td>
            </ng-container>

            <!-- Total fees Column -->
            <ng-container matColumnDef="total_fees">
                <th mat-header-cell *matHeaderCellDef> Fee </th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field appearance="outline" style="padding-top: 5%;">
                        <input matInput [disabled]="element !== selectedSymbol" placeholder="{{element.total_fees}}"
                            [(ngModel)]="element.total_fees">
                    </mat-form-field>
                </td>
            </ng-container>

            <!-- Average Price Column -->
            <ng-container matColumnDef="average_purchase_price">
                <th mat-header-cell *matHeaderCellDef> Average Price </th>
                <td mat-cell *matCellDef="let element"> {{element.average_purchase_price | currency}} </td>
            </ng-container>

            <!-- Current Price Column -->
            <ng-container matColumnDef="current_price">
                <th mat-header-cell *matHeaderCellDef> Current Price </th>
                <td mat-cell *matCellDef="let element"> {{element.current_price | currency}} </td>
            </ng-container>

            <!-- Sell button -->
            <ng-container matColumnDef="sell">
                <th mat-header-cell *matHeaderCellDef> Sell </th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button (click)="sell(element)" [disabled]="element !== selectedSymbol"
                        [mat-dialog-close]="true">
                        <mat-icon fontSet="material-symbols-outlined"
                            [ngClass]="{'selected': element === selectedSymbol}">sell</mat-icon>
                    </button>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selectRow(row)"
                [ngClass]="{'selected': row === selectedSymbol}"></tr>
        </table>
        }
    }
    <div class="actions">
        <div>
            <button mat-raised-button [mat-dialog-close]="true">
                Cancel
                <mat-icon fontSet="material-symbols-outlined">cancel</mat-icon>
            </button>
        </div>
    </div>
</div>